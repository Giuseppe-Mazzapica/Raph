/**
 * Part of Raph WordPress plugin
 * Author: Giuseppe Mazzapica <giuseppe.mazzapica@gmail.com>
 * License: MIT
 */
!function(e,t,n,o,a){n.methods={},n.backup={},n.methods.updateEditor=function(t){var o=t.getContent();-1!==o.search(/\[.+\]/)?(e("#raph-notice").length&&e("#raph-notice").remove(),n.methods.render(o,t)):n.methods.htmlNotice(n.i18n.no_shortcodes,"error")},n.methods.render=function(e,t){n.methods.backup(t,e),n.methods.ajaxCall(e).done(function(e){n.methods.ajaxDone(e,t)}).fail(function(){n.methods.htmlNotice(n.i18n.ajax_error,"error"),n.backup={}})},n.methods.ajaxCall=function(t){return e.ajax({type:"POST",url:o,dataType:"json",cache:!1,data:{action:"raph-render",pid:n.data.pid,type:n.data.type,raph_check:n.data.raph_check,content:t}})},n.methods.ajaxDone=function(e,t){if(e.success&&e.data.content){t.setContent(e.data.content);var o=n.i18n.notice;o+=' <a id="raph-restore" href="#wp-content-wrap">'+n.i18n.restore+"</a>",n.methods.htmlNotice(o,"updated"),t.onChange.add(function(){n.backup.editor&&(n.backup.changed=!0)})}else n.methods.htmlNotice(n.i18n.ajax_error,"error"),n.backup={}},n.methods.htmlNotice=function(t,n){e("#wp-content-wrap").prepend('<div id="raph-notice" class="'+n+'"><p>'+t+"</p></div>"),"error"===n&&setTimeout(function(){e("#raph-notice").remove()},5e3)},n.methods.backup=function(e,t){n.backup.editor=e,n.backup.content=t,n.backup.changed=!1},n.methods.restoreContentConfirm=function(){if(n.backup.editor){var t=!n.backup.changed;t||(t=confirm(n.i18n.conf1+"\n"+n.i18n.conf2)),t&&(n.methods.restoreContent(),e("#raph-notice").remove(),n.backup={})}},n.methods.restoreContent=function(){n.backup.editor&&n.backup.editor.setContent(n.backup.content)},t.PluginManager.add("raph_render",function(e){e.addButton("raph_render",{title:n.i18n.button_title,icon:"raph dashicons-admin-appearance",onclick:function(){n.methods.updateEditor(e)}})}),e(a).on("click","#raph-restore",function(e){e.preventDefault(),n.methods.restoreContentConfirm()})}(jQuery,tinymce,Raph,ajaxurl,document);